<div class="repository-details">
  <a (click)="goBackToHome()" class="back-button">&larr; Back to repositories</a>

  @if (loading()) {
  <app-loading></app-loading>
  } @else {

  <header class="repository-header">
    <div>
      <img class="owner-avatar" [src]="repository()?.owner.avatar_url" alt="Owner Avatar" />
      <h1>{{ repository()?.name }}</h1>
    </div>
    <div class="repository-stats">
      <span class="stat">
        <i class="fas fa-star"></i>
        {{ repository()?.stargazers_count || 0 }} stars
      </span>
      <span class="stat">
        <i class="fas fa-exclamation-circle"></i>
        {{ repository()?.open_issues_count || 0 }} open issues
      </span>
    </div>
  </header>

  <section class="issues-section">
    <h2>Issues</h2>

    <div class="issues-list">
      @for (issue of issues(); track issue.id) {
      <div class="issue-card" (click)="navigateToIssue(issue)">
        <span class="issue-number">#{{ issue.number }}</span>
        <h3 class="issue-title">{{ issue.title }}</h3>
        <p class="issue-info">Opened by {{ issue.user.login }} on {{ issue.created_at | date }}</p>
      </div>
      } @empty {
      <p>No issues found</p>
      }
    </div>

    <div class="per-page-selector">
      <label for="per-page">View up to</label>
      <select id="per-page" (change)="changePerPage($event)">
        @for(option of perPageOptions; track option) {
        <option [value]="option" [selected]="option === perPage">{{ option }}</option>
        }
      </select>
      <span for="per-page">per page</span>
    </div>

    @if(issues().length > 0) {
    <div class="pagination-container">
      <div class="pagination">
        <button [disabled]="currentPage() === 1" (click)="previousPage()">Previous</button>
        <span>Page {{ currentPage() }} of {{ repository()?.open_issues_count || 0 }}</span>
        <button [disabled]="!hasNextPage()" (click)="nextPage()">Next</button>
      </div>
    </div>
    }
  </section>
  }
</div>
